<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>MongoDB on FuweaY</title><link>https://FuweaY.github.io/categories/mongodb/</link><description>Recent content in MongoDB on FuweaY</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><lastBuildDate>Mon, 20 Jul 2020 12:00:00 +0800</lastBuildDate><atom:link href="https://FuweaY.github.io/categories/mongodb/index.xml" rel="self" type="application/rss+xml"/><item><title>MongoDB Oplog å’Œ Journal File</title><link>https://FuweaY.github.io/p/mongodb-oplog-journalfile/</link><pubDate>Mon, 20 Jul 2020 12:00:00 +0800</pubDate><guid>https://FuweaY.github.io/p/mongodb-oplog-journalfile/</guid><description>&lt;h2 id="journaling">Journaling
&lt;/h2>&lt;p>é—œæ–¼ journal åœ¨ MongoDB å®˜æ–¹æ–‡æª”çš„é–‹é ­æœ‰ä»¥ä¸‹æè¿°ï¼š&lt;/p>
&lt;blockquote>
&lt;p>To provide durability in the event of a failure, MongoDB usesÂ &lt;em>write ahead logging&lt;/em>
to on-disk &lt;a class="link" href="https://www.mongodb.com/docs/v4.2/reference/glossary/#term-journal" target="_blank" rel="noopener"
>journal&lt;/a> files.&lt;/p>&lt;/blockquote>
&lt;p>å¯ä»¥è®“æˆ‘å€‘äº†è§£ MongoDB çš„ journal files æ˜¯ä¸€ç¨®é å¯«æ—¥èªŒ(WAL)ï¼Œä½œç”¨å°±é¡žä¼¼ MySQL çš„ redolog ï¼Œéƒ½æ˜¯ç‚ºäº†åœ¨ DB æœå‹™æ„å¤– crash å¾Œæ¢å¾©æ•¸æ“šä¿è­‰æ•¸æ“šæŒä¹…æ€§çš„æ–¹æ³•ã€‚&lt;/p>
&lt;h3 id="journaling-å’Œ-wiredtiger-å„²å­˜å¼•æ“Ž">Journaling å’Œ WiredTiger å„²å­˜å¼•æ“Ž
&lt;/h3>&lt;p>WiredTiger ä½¿ç”¨ checkpoints ä¾†&lt;/p>
&lt;p>æ¢å¾©çš„æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>åœ¨ data files ä¸­æ‰¾åˆ°æœ€å¾Œä¸€å€‹ checkpoint&lt;/li>
&lt;li>åœ¨ journal files ä¸­æ‰¾åˆ°ä¸Šä¸€æ­¥é©Ÿä¸­çš„ checkpoint&lt;/li>
&lt;li>æ‡‰ç”¨ journal files ä¸­ä¸Šä¸€æ­¥é©Ÿ checkpoint ä¹‹å¾Œçš„æ“ä½œ&lt;/li>
&lt;/ol>
&lt;h3 id="journaling-process">Journaling Process
&lt;/h3>&lt;p>WiredTiger æœƒç‚ºæ¯å€‹ clinet ç«¯ç™¼èµ·çš„å¯«æ“ä½œå‰µå»ºä¸€å€‹ journal record ç´€éŒ„åŒ…å«å…§éƒ¨çš„æ‰€æœ‰å¯«å…¥æ“ä½œï¼Œä¾‹å¦‚ï¼šåŸ·è¡Œäº† update æ“ä½œï¼Œjournal record é™¤äº†æœƒè¨˜éŒ„æ›´æ–°æ“ä½œåŒæ™‚ä¹Ÿæœƒè¨˜éŒ„ç›¸æ‡‰ç´¢å¼•çš„ä¿®æ”¹ã€‚&lt;/p>
&lt;p>MongoDB è¨­å®š WiredTiger ä½¿ç”¨å…§å­˜ buffer ä¾†å„²å­˜ journal record&lt;/p>
&lt;p>WiredTiger æœƒåœ¨ä»¥ä¸‹æƒ…æ³ä¸‹å°‡ buffere ä¸­çš„ journal records å¯«å…¥ diskï¼š&lt;/p>
&lt;ul>
&lt;li>å°æ–¼ replica set members (åŒ…å« primary å’Œ secondary)ï¼š
&lt;ul>
&lt;li>If there are operations waiting for oplog entries. Operations that can wait for oplog entries include:
&lt;ul>
&lt;li>forward scanning queries against the oplog&lt;/li>
&lt;li>read operations performed as part ofÂ &lt;a class="link" href="https://www.mongodb.com/docs/v4.2/core/read-isolation-consistency-recency/#causal-consistency" target="_blank" rel="noopener"
>causally consistent sessions&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å°æ–¼ secondary åœ¨æ¯æ¬¡æ‰¹é‡æ‡‰ç”¨ oplog ä¹‹å¾Œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ç•¶å¯«å…¥æ“ä½œåŒ…å« &lt;code>j: true&lt;/code> é¸é …ã€‚&lt;/li>
&lt;li>ä¾æ“š &lt;a class="link" href="https://www.mongodb.com/docs/v4.2/reference/configuration-options/#storage.journal.commitIntervalMs" target="_blank" rel="noopener"
>&lt;code>storage.journal.commitIntervalMs&lt;/code>&lt;/a> çš„è¨­ç½®é »çŽ‡ï¼Œé è¨­ç‚ºæ¯ 100 msã€‚&lt;/li>
&lt;li>ç•¶ WiredTiger å‰µå»ºä¸€å€‹æ–°çš„ journal file æ™‚ï¼Œç´„ç‚ºæ¯ 100MB æ•¸æ“šæœƒå‰µå»ºä¸€å€‹æ–°çš„ journal fileã€‚&lt;/li>
&lt;/ul>
&lt;aside>
ðŸ’¡ é€éŽ serverStatus æŒ‡ä»¤ä¸­çš„ wiredTiger.log è³‡è¨Šå¯ä»¥æŸ¥çœ‹ WiredTiger journal çš„çµ±è¨ˆè³‡è¨Šã€‚
&lt;/aside>
&lt;h3 id="journal-file">Journal file
&lt;/h3>&lt;p>MongoDB æœƒåœ¨ dbPath è¨­å®šçš„ç›®éŒ„ä¸‹ä¸­å»ºç«‹ä¸€å€‹åç‚º journal çš„ç›®éŒ„ï¼ŒWiredTiger çš„ journal file æœƒåœ¨é€™å€‹ journal ç›®éŒ„ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">âžœ ll /var/lib/mongo/journal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ç¸½è¨ˆ &lt;span class="m">307200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> root root &lt;span class="m">104857600&lt;/span> 7æœˆ &lt;span class="m">15&lt;/span> 17:04 WiredTigerLog.0000000058
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> root root &lt;span class="m">104857600&lt;/span> 7æœˆ &lt;span class="m">12&lt;/span> 16:49 WiredTigerPreplog.0000000027
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> root root &lt;span class="m">104857600&lt;/span> 7æœˆ &lt;span class="m">15&lt;/span> 16:29 WiredTigerPreplog.0000000054
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶ä¸­ WiredTigerLog.{åºè™Ÿ} æ˜¯å·²è¨˜éŒ„æˆ–ä½¿ç”¨ä¸­çš„ Journal fileï¼Œè€Œ WiredTigerPreplog.{åºè™Ÿ} æ˜¯é å…ˆåˆ†é…çš„ Journal fileã€‚&lt;/p>
&lt;p>WiredTiger çš„ journal file æœ€å¤§å¤§å°ç‚º 100MBï¼Œç•¶è¶…éŽæ™‚æœƒå»ºç«‹ä¸€å€‹æ–°çš„ journal fileï¼Œæ­¤å¤–æœƒè‡ªå‹•åˆªé™¤èˆŠçš„ journal file åƒ…ä¿ç•™å¾žä¸Šä¸€å€‹ checkpoint æ¢å¾©æ‰€éœ€è¦çš„æ–‡ä»¶ã€‚&lt;/p>
&lt;h2 id="journal-record">Journal record
&lt;/h2>&lt;ul>
&lt;li>WiredTiger æœƒç‚ºæ¯å€‹ clinet ç«¯ç™¼èµ·çš„å¯«æ“ä½œå‰µå»ºä¸€å€‹ journal record ç´€éŒ„åŒ…å«å…§éƒ¨çš„æ‰€æœ‰å¯«å…¥æ“ä½œï¼Œä¾‹å¦‚ï¼šåŸ·è¡Œäº† update æ“ä½œï¼Œjournal record é™¤äº†æœƒè¨˜éŒ„æ›´æ–°æ“ä½œåŒæ™‚ä¹Ÿæœƒè¨˜éŒ„ç›¸æ‡‰ç´¢å¼•çš„ä¿®æ”¹ã€‚&lt;/li>
&lt;li>æ¯å€‹ record æœƒæœ‰ä¸€å€‹ unique identifier&lt;/li>
&lt;li>WiredTiger çš„ journal record æœ€å°æœ‰ 128 bytes çš„å¤§å°ã€‚&lt;/li>
&lt;/ul>
&lt;p>é è¨­æƒ…æ³ä¸‹ MongoDB æœƒå°‡ WiredTiger è¶…éŽ 128 bytes çš„ journal record ä½¿ç”¨ &lt;code>snappy&lt;/code> é€²è¡Œå£“ç¸®ï¼Œé€™éƒ¨åˆ†å¯ä»¥é€éŽ&lt;a class="link" href="https://www.mongodb.com/docs/v4.2/reference/configuration-options/#storage.wiredTiger.engineConfig.journalCompressor" target="_blank" rel="noopener"
>&lt;code>storage.wiredTiger.engineConfig.journalCompressor&lt;/code>&lt;/a> è¨­å®šä¸åŒçš„å£“ç¸®æ¼”ç®—æ³•&lt;/p>
&lt;h2 id="oplog">OpLog
&lt;/h2>&lt;p>MongoDB åœ¨ primary node ä¸Šæ‡‰ç”¨è³‡æ–™åº«æ“ä½œä¹‹å¾Œæœƒå°‡å…¶è¨˜éŒ„åˆ° OpLogï¼Œä¹‹å¾Œ secondary node æœƒè¤‡è£½ä¸¦æ‡‰ç”¨é€™äº›æ“ä½œï¼Œä¹Ÿå°±æ˜¯é¡žä¼¼æ–¼ MySQL çš„ binlogã€‚&lt;/p>
&lt;p>oplog ä¸­çš„æ¯å€‹æ“ä½œéƒ½æ˜¯å†ªç­‰ï¼Œä¹Ÿå°±æ˜¯èªª oplog ç„¡è«–åœ¨ç›®æ¨™ node ä¸Šæ‡‰ç”¨ä¸€æ¬¡æˆ–å¤šæ¬¡éƒ½æœƒç”¢ç”Ÿç›¸åŒçš„çµæžœã€‚&lt;/p>
&lt;p>cluster ä¸­çš„æ‰€æœ‰ node éƒ½åŒ…å« &lt;a class="link" href="http://local.oplog.rs" target="_blank" rel="noopener"
>local.oplog.rs&lt;/a> collection ä¸­çš„ oplog å‰¯æœ¬ï¼Œæ‰€ä»¥æ‰€æœ‰çš„ secondary node å¯ä»¥å‘ cluster å…§çš„ä»»æ„ node ç²å– oplogã€‚&lt;/p>
&lt;h2 id="åƒè€ƒ">åƒè€ƒ
&lt;/h2>&lt;p>Journal file&lt;/p>
&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/v4.2/core/journaling/" target="_blank" rel="noopener"
>Journaling â€” MongoDB Manual&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/v4.2/core/wiredtiger/#storage-wiredtiger-checkpoints" target="_blank" rel="noopener"
>WiredTiger Storage Engine â€” MongoDB Manual&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.csdn.net/chechengtao/article/details/105913943" target="_blank" rel="noopener"
>ã€MongoDBã€‘æ•°æ®å­˜å‚¨ï¼ˆStorageï¼‰ä¹‹ æ—¥å¿—ï¼ˆJournalingï¼‰_å¥‡æ–¯çš„åšå®¢-CSDNåšå®¢_wiredtiger&lt;/a>&lt;/p>
&lt;p>OpLOG&lt;/p>
&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/manual/core/replica-set-oplog/" target="_blank" rel="noopener"
>Replica Set Oplog â€” MongoDB Manual&lt;/a>&lt;/p></description></item><item><title>MongoDB å‚™ä»½é‚„åŽŸ</title><link>https://FuweaY.github.io/p/mongodb-backup-restore/</link><pubDate>Wed, 15 Jul 2020 12:00:00 +0800</pubDate><guid>https://FuweaY.github.io/p/mongodb-backup-restore/</guid><description>&lt;h2 id="mongodumpmongorestore">mongodumpã€mongorestore
&lt;/h2>&lt;p>å°‡ MongoDB çš„è³‡æ–™å…§å®¹å°Žå‡ºæˆäºŒé€²åˆ¶æª”æ¡ˆ&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mongodump &amp;lt;options&amp;gt; &amp;lt;connection-string&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongorestore &amp;lt;options&amp;gt; &amp;lt;connection-string&amp;gt; &amp;lt;directory or file to restore&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ &lt;code>--uri&lt;/code> æˆ–è€…æ˜¯ &lt;code>--host&lt;/code> çš„æ–¹å¼æŒ‡å®šè¦é€£ç·šçš„ MongoDB æœå‹™ï¼Œå¦‚ä¸‹ç¯„ä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é€£ç·šåˆ° mongoDB instance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --uri&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;mongodb://mongodb0.example.com:27017&amp;#34;&lt;/span> &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --host&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;mongodb0.example.com:27017&amp;#34;&lt;/span> &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --host&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;mongodb0.example.com&amp;#34;&lt;/span> --port&lt;span class="o">=&lt;/span>&lt;span class="m">27017&lt;/span> &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é€£ç·šåˆ° mongoDB replica set (å„ªå…ˆå¾ž primary è®€å–)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --uri&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;mongodb://mongodb0.example.com:27017,mongodb1.example.com:27017,mongodb2.example.com:27017/?replicaSet=myReplicaSetName&amp;#34;&lt;/span> &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --host&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myReplicaSetName/mongodb0.example.com:27017,mongodb1.example.com:27017,mongodb2.example.com&amp;#34;&lt;/span> &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é€£ç·šåˆ° mongoDB replica set (å„ªå…ˆå¾ž secondary è®€å–)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --uri&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;mongodb://mongodb0.example.com:27017,mongodb1.example.com:27017,mongodb2.example.com:27017/?replicaSet=myReplicaSetName&amp;amp;readPreference=secondary&amp;#34;&lt;/span> &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --host&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myReplicaSetName/mongodb0.example.com:27017,mongodb1.example.com:27017,mongodb2.example.com:27017&amp;#34;&lt;/span> --readPreference&lt;span class="o">=&lt;/span>secondary &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é€£ç·šåˆ° mongoDB replica set (å„ªå…ˆå¾ž secondary è®€å–ï¼Œä¸¦æŒ‡å®š tag)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --uri&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;mongodb://mongodb0.example.com:27017,mongodb1.example.com:27017,mongodb2.example.com:27017/?replicaSet=myReplicaSetName&amp;amp;readPreference=secondary&amp;amp;readPreferenceTags=region:east&amp;#34;&lt;/span> &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --host&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myReplicaSetName/mongodb0.example.com:27017,mongodb1.example.com:27017,mongodb2.example.com:27017&amp;#34;&lt;/span> --readPreference&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{mode: &amp;#34;secondary&amp;#34;, tagSets: [ { &amp;#34;region&amp;#34;: &amp;#34;east&amp;#34; } ]}&amp;#39;&lt;/span> &lt;span class="o">[&lt;/span>additional options&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¡Œç‚º">è¡Œç‚º
&lt;/h3>&lt;ol>
&lt;li>åªèƒ½é‚„åŽŸåˆ°ç›¸åŒç‰ˆæœ¬çš„ MongoDB æœå‹™ï¼Œä¸¦ä¸” mongodump å’Œ mongorestore ç‰ˆæœ¬ä¹Ÿéœ€è¦ç›¸åŒã€‚&lt;/li>
&lt;li>é è¨­æƒ…æ³ä¸‹æœƒå„ªå…ˆé€£ç·š Primary nodeï¼Œå¯ä»¥é€éŽ &lt;code>readPreference&lt;/code> é¸é …ä¾†èª¿æ•´ã€‚&lt;/li>
&lt;li>mongodump ä¸æœƒ dump &lt;code>local&lt;/code> databaseã€‚&lt;/li>
&lt;li>mongodump ä¸æœƒå‚™ä»½ indexï¼Œéœ€è¦è‡ªè¡Œé‡å»ºã€‚&lt;/li>
&lt;li>å¦‚æžœæœ‰ä½¿ç”¨ read-only viewsï¼Œmongodump é è¨­åªæœƒ dump å…¶ metadataï¼Œéœ€è¦æ·»åŠ  &lt;code>--viewAsCollections&lt;/code> ä¾†åŒ¯å‡º view ä¸­çš„æ•¸æ“šã€‚&lt;/li>
&lt;li>mongodump æœƒåœ¨ä»¥ä¸‹æƒ…æ³ä¸‹ failsï¼š
&lt;ul>
&lt;li>ç•¶ resharding æ­£åœ¨é‹è¡Œæ™‚ã€‚&lt;/li>
&lt;li>ç•¶ reshardCollection æŒ‡ä»¤åœ¨ mongodump æ“ä½œæœŸé–“åŸ·è¡Œæ™‚ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>å° WiredTiger å¼•æ“Žä½¿ç”¨ mongodump æœƒåŒ¯å‡ºæœªå£“ç¸®çš„æ•¸æ“šã€‚&lt;/li>
&lt;li>mongodump æœƒå½±éŸ¿åˆ° mongod çš„æ€§èƒ½ï¼Œå¦‚æžœæ•¸æ“šé‡å¤§æ–¼ç³»çµ±å…§å­˜ mongodump æœƒå°Žè‡´ working set è¢«æŽ¨å‡ºå…§å­˜ã€‚&lt;/li>
&lt;li>mongodump éœ€è¦å…·æœ‰æ¬²å‚™ä»½ database çš„ find æ¬Šé™ï¼Œå…§å»ºçš„ &lt;code>backup&lt;/code> role å…·æœ‰å‚™ä»½æ‰€æœ‰ database çš„æ¬Šé™ã€‚&lt;/li>
&lt;/ol>
&lt;h3 id="å¸¸ç”¨é¸é …">å¸¸ç”¨é¸é …
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>&lt;code>--uri&lt;/code> ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">--uri&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mongodump --username joe --password secret1 mongodb://mongodb0.example.com:27017 --ssl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>--host=&amp;lt;hostname&amp;gt;&amp;lt;:port&amp;gt;, -h=&amp;lt;hostname&amp;gt;&amp;lt;:port&amp;gt;&lt;/code>ï¼šæŒ‡å®šè¦é€£ç·šçš„ mongodã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>--readPreference=&amp;lt;string|document&amp;gt;&lt;/code>ï¼šæŒ‡å®šå„ªå…ˆè®€å–çš„ nodeï¼Œé è¨­å€¼ç‚º primaryï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>maxStalenessSecondsï¼šç”±æ–¼å„ç¨®åŽŸå›  secondary node å¯ä»¥æœƒè½å¾Œ prmary nodeï¼Œè©²é¸é …ç”¨ä¾†è¨­å®š secondary node æœ€å¤§å»¶é²çš„ç§’æ•¸ï¼Œç•¶ secondary è½å¾Œè¶…éŽè©²ç§’æ•¸å‰‡ mongodump åœæ­¢é€²è¡Œè®€å–æ“ä½œï¼Œè©²å€¼å¿…é ˆå¤§æ–¼ç­‰æ–¼ 90ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å„ªå…ˆè®€å– secondary node&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--readPreference&lt;span class="o">=&lt;/span>secondary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å„ªå…ˆè®€å– secondary ä¸­ tag ç‚º region:east çš„ nodeï¼Œå…è¨±çš„æœ€å¤§å»¶é²ç‚º 120&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--readPreference&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{mode: &amp;#34;secondary&amp;#34;, tagSets: [ { &amp;#34;region&amp;#34;: &amp;#34;east&amp;#34; } ], maxStalenessSeconds: 120}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>--db=&amp;lt;database&amp;gt;, -d=&amp;lt;database&amp;gt;&lt;/code>ï¼šæŒ‡å®šè¦å‚™ä»½çš„ databaseï¼Œè‹¥æœªæŒ‡å®šæœƒå‚™ä»½ &lt;code>local&lt;/code> ä»¥å¤–çš„æ‰€æœ‰ databaseã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>--collection=&amp;lt;collection&amp;gt;, -c=&amp;lt;collection&amp;gt;&lt;/code>ï¼šæŒ‡å®šè¦å‚™ä»½çš„ collectionï¼Œè‹¥æœªæŒ‡å®šæœƒå‚™ä»½ database å…§çš„æ‰€æœ‰ collectionã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>--query=&amp;lt;json&amp;gt;, -q=&amp;lt;json&amp;gt;&lt;/code>ï¼šå¿…é ˆæ­é… &lt;code>--collection&lt;/code> é¸é …ï¼Œåƒ…åŒ¯å‡ºç¬¦åˆæ­¤æ¢ä»¶çš„æ•¸æ“šï¼Œå¿…é ˆä½¿ç”¨å–®å¼•è™Ÿ &lt;code>'&lt;/code> å°‡æŸ¥è©¢æ–‡æª”åŒ…èµ·ä¾†ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mongodump -d&lt;span class="o">=&lt;/span>&lt;span class="nb">test&lt;/span> -c&lt;span class="o">=&lt;/span>records -q&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{ &amp;#34;a&amp;#34;: { &amp;#34;$gte&amp;#34;: 3 }, &amp;#34;date&amp;#34;: { &amp;#34;$lt&amp;#34;: { &amp;#34;$date&amp;#34;: &amp;#34;2016-01-01T00:00:00.000Z&amp;#34; } } }&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>--gzip&lt;/code>ï¼šå£“ç¸®è¼¸å‡ºã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>--oplog&lt;/code>ï¼šç•¶æ²’æœ‰è©²é¸é …æ™‚ï¼Œmongodump é‹è¡ŒæœŸé–“çš„å¯«å…¥&lt;/p>
&lt;p>å°‡ mongodump é‹ä½œæœŸé–“ç”¢ç”Ÿçš„ oplog ä¸€ä½µåŒ¯å‡ºï¼Œè©²æª”æ¡ˆæä¾›äº†&lt;/p>
&lt;p>mongodump &amp;ndash;oplog é‹è¡ŒéŽç¨‹ä¸­ client ç«¯é‹è¡Œä»¥ä¸‹æŒ‡ä»¤å°‡å°Žè‡´ mogodump å¤±æ•—ï¼š&lt;/p>
&lt;ul>
&lt;li>renameCollection&lt;/li>
&lt;li>db.collection.renameCollection()&lt;/li>
&lt;li>db.collection.aggregate() with $out&lt;/li>
&lt;/ul>
&lt;p>mongodump &amp;ndash;oplog å¿…é ˆå®Œæ•´å‚™ä»½ replica set ï¼Œå› æ­¤ä¸å¯å’Œ &lt;code>--db&lt;/code> åŠ &lt;code>--collection&lt;/code> ä¸€èµ·ä½¿ç”¨ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="å‚™ä»½ç­–ç•¥">å‚™ä»½ç­–ç•¥
&lt;/h3>&lt;p>mogodumpã€mongorestore å¯ä»¥ä½œç‚ºå–®å¯¦ä¾‹ã€ä¸€èˆ¬ cluster çš„å‚™æ´æ–¹æ¡ˆ&lt;/p>
&lt;p>mongodumpã€mongorestore é€šéŽèˆ‡æ­£åœ¨é‹è¡Œçš„ mongod instance äº¤äº’ä¾†é‹è¡Œï¼Œä¸åƒ…æœƒç”¢ç”Ÿæµé‡ï¼Œé‚„æœƒå¼·åˆ¶è³‡æ–™åº«é€éŽè¨˜æ†¶é«”è®€å–æ‰€æœ‰æ•¸æ“šï¼Œå› æ­¤æœƒå°Žè‡´mongod æ€§èƒ½ä¸‹é™ã€‚&lt;/p>
&lt;p>mogodumpã€mongorestore ä¸èƒ½ä½œç‚º sharding cluster çš„å‚™æ´æ–¹æ¡ˆï¼Œå› ç‚º mongodump å‰µå»ºçš„å‚™ä»½ä¸æœƒç¶­è­·è·¨ shard äº‹å‹™çš„åŽŸå­æ€§ä¿è­‰ã€‚&lt;/p>
&lt;p>å°æ–¼ sharding cluster å»ºè­°ä½¿ç”¨ä»¥ä¸‹æ”¯æŒç¶­è­·è·¨ shard äº‹å‹™åŽŸå­æ€§ä¿è­‰çš„å‚™æ´æ–¹æ¡ˆï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.mongodb.com/cloud/atlas?tck=docs_databasetools" target="_blank" rel="noopener"
>MongoDB Atlas&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.mongodb.com/cloud/cloud-manager?tck=docs_databasetools" target="_blank" rel="noopener"
>MongoDB Cloud Manager&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.mongodb.com/products/ops-manager?tck=docs_databasetools" target="_blank" rel="noopener"
>MongoDB Ops Manager&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="mongoexport">mongoexport
&lt;/h2>&lt;p>å¯ä»¥å°‡ MongoDB ä¸­çš„æ•¸æ“šåŒ¯å‡ºæˆ JSON æˆ– CSV æ ¼å¼ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mongoexport --collection&lt;span class="o">=&lt;/span>&amp;lt;coll&amp;gt; &amp;lt;options&amp;gt; &amp;lt;connection-string&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="mongoimport">mongoimport
&lt;/h2>&lt;p>å°‡ mongoexport æˆ–å…¶ä»–ç¬¬ä¸‰æ–¹åŒ¯å‡ºçš„ JSONã€CSV æˆ– TSV æ ¼å¼çš„æ•¸æ“šåŒ¯å…¥åˆ° MongoDBã€‚&lt;/p>
&lt;h2 id="åƒè€ƒ">åƒè€ƒ
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/database-tools/mongodump/" target="_blank" rel="noopener"
>mongodump â€” MongoDB Database Tools&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/database-tools/mongorestore/" target="_blank" rel="noopener"
>mongorestore â€” MongoDB Database Tools&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/database-tools/mongoexport/" target="_blank" rel="noopener"
>mongoexport â€” MongoDB Database Tools&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/database-tools/mongoimport/" target="_blank" rel="noopener"
>mongoimport â€” MongoDB Database Tools&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/manual/tutorial/backup-and-restore-tools/" target="_blank" rel="noopener"
>Back Up and Restore with MongoDB Tools â€” MongoDB Manual&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.mongodb.com/docs/manual/core/backups/" target="_blank" rel="noopener"
>MongoDB Backup Methods â€” MongoDB Manual&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.cnblogs.com/yaoxing/p/mongodb-backup-rules.html" target="_blank" rel="noopener"
>MongoDBçš„å¸¸è§„å¤‡ä»½ç­–ç•¥ - yaoxing - åšå®¢å›­ (cnblogs.com)&lt;/a>&lt;/p></description></item></channel></rss>